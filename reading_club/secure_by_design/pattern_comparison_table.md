# エンティティ作成パターンの使い分け

## 📊 基本特性比較

| 項目 | コンストラクタ | フルーエント | ビルダー |
|------|---------------|-------------|---------|
| **実装の簡単さ** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐ |
| **学習コスト** | 低 | 中 | 高 |
| **可読性** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **型安全性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **セキュリティ** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

## 🎯 適用場面

| パターン | 最適な場面 | 避けるべき場面 |
|---------|-----------|---------------|
| **コンストラクタ** | • 必須項目のみ（3-5個以下）<br>• シンプルな制約<br>• 高速な開発が必要<br>• チーム習熟度が低い | • 引数が多い（6個以上）<br>• 任意項目が多数<br>• 複雑な項目間制約 |
| **フルーエント** | • 任意項目が多数<br>• コードの可読性重視<br>• API設計が重要<br>• 段階的な設定が自然 | • 複雑な項目間依存<br>• 厳密な型チェックが必要<br>• パフォーマンス最重視 |
| **ビルダー** | • 複雑な相互依存関係<br>• 厳密なセキュリティ要求<br>• 段階的構築が必要<br>• 設定パターンが多様 | • シンプルな要求<br>• 開発期間が短い<br>• 小規模なチーム |

## 💡 具体例による使い分け

### 🏦 **金融システム**
| エンティティ | 推奨パターン | 理由 |
|-------------|-------------|------|
| **User（ユーザー）** | コンストラクタ | `(id, name, email)` - シンプルで必須のみ |
| **BankAccount（口座）** | コンストラクタ | `(accountNo, balance, owner)` - 厳密な検証 |
| **Transaction（取引）** | ビルダー | 複雑な制約（限度額、時間制限、承認フロー） |

### 🛒 **ECサイト**
| エンティティ | 推奨パターン | 理由 |
|-------------|-------------|------|
| **Product（商品）** | コンストラクタ | `(id, name, price)` - 基本情報のみ |
| **Order（注文）** | フルーエント | 配送先、支払方法など任意項目多数 |
| **Campaign（キャンペーン）** | ビルダー | 複雑な適用条件（期間、対象、割引率） |

### 🏥 **医療システム**
| エンティティ | 推奨パターン | 理由 |
|-------------|-------------|------|
| **Patient（患者）** | コンストラクタ | `(id, name, birthDate)` - 基本情報 |
| **Prescription（処方箋）** | ビルダー | 薬剤間の相互作用、アレルギーチェック |
| **Appointment（予約）** | フルーエント | 日時、医師、診療科など設定項目多数 |

## ⚡ パフォーマンス比較

| パターン | 作成速度 | メモリ使用量 | 実行時オーバーヘッド |
|---------|---------|-------------|------------------|
| **コンストラクタ** | 最高速 | 最小 | なし |
| **フルーエント** | 高速 | 中程度 | 軽微 |
| **ビルダー** | 中程度 | 大きめ | 中程度（検証コスト） |

## 🔄 移行戦略

### レガシーコードからの移行順序

1. **フェーズ1**: 危険な引数なしコンストラクタを特定
2. **フェーズ2**: シンプルなものから**コンストラクタ**に変更
3. **フェーズ3**: 任意項目が多いものを**フルーエント**に変更
4. **フェーズ4**: 複雑な制約があるものを**ビルダー**に変更

## 🎯 決定フローチャート

```
エンティティ設計開始
↓
必須項目は何個？
├─ 3個以下 → コンストラクタ
├─ 4-6個 → 任意項目は？
│  ├─ 少ない → コンストラクタ
│  └─ 多い → フルーエント
└─ 7個以上 → 制約は複雑？
   ├─ シンプル → フルーエント
   └─ 複雑 → ビルダー
```

## 🚀 実践的な選び方

### **迷ったら...**
- **小さく始める**: まずはコンストラクタから
- **段階的に進化**: 要求が複雑になったら上位パターンに移行
- **チームスキル**: チームの習熟度に合わせて選択
- **保守性重視**: 長期間維持するシステムはビルダーも検討

### **絶対に避けるべき組み合わせ**
- ❌ 複雑な制約 + コンストラクタ → セキュリティホール
- ❌ シンプルな要求 + ビルダー → オーバーエンジニアリング
- ❌ 引数なしコンストラクタ + 任意のパターン → 根本的な問題